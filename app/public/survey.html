<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
        crossorigin="anonymous">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Architects+Daughter|Gloria+Hallelujah|Rock+Salt" rel="stylesheet">

    <!-- My CSS -->
    <style>
        .jumbotron{
            background-color: rgba(230, 230, 230, 1);
            min-height: 100%;
            background-image: url("/app/images/pets-banner.png");
            background-position: center bottom;
            background-repeat: no-repeat;
            background-size: contain;
            background-blend-mode: overlay;
        }
        .display-4, .card-header, .find-button, .modal-header{
            font-family: 'Gloria Hallelujah', cursive;
        }
        .lead, .btn, .modal-body{
            font-family: 'Architects Daughter', cursive;
        }
        .mini-pet {
            height:50px;
            margin-right: 10px;
        }
        .find-button {
            font-size: 24px;
            border-radius: 10px;
        }
        #survey-cat{
            width: 110px;
        }
        .selection-button{
            width:30px;
            border-left-style:solid;
            border-right-style: solid;
            border-left-color: #aaa;
            border-right-color: #aaa;
        }

        .modal-picture{
            width: auto;
            max-width: 100%;
            max-height: 300px;
        }

        .modal-content {
            
        }
   
        .pet-name {
            font-family: 'Rock Salt', cursive;
            font-weight: bold;
        }

    </style>

    <title>Pet Pal - Survey</title>
</head>

<body>

    <div class="jumbotron jumbotron-fluid text-center">
        <div class="container">
            <img src="/app/images/survey.gif" alt="Survey Cat" class="m-0 ml-5 float-left" id="survey-cat">
            <h1 class="display-4">Pet Pal Intro&shy;ductions</h1>
            <p class="lead">Tell us some things about your pet so we can better match them to a playmate!</p>
            <a href="/"><button class="btn-primary find-button p-2 mt-2"><img src="/app/images/mini-cat.gif" alt="mini-pet" class="mini-pet">Home</button></a>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col"></div>
            <div class="col-12 col-md-10 col-lg-8">
                <div class="card mt-3" id="user-info">
                    <div class="card-header d-none" id="user-info-messages"></div>
                    <div class="card-text p-3">
                        <form role="form">
                            <div class="form-group">
                                <label for="name">
                                    <h6>Name</h6>
                                </label>
                                <input type="text" class="form-control" id="name">
                            </div>

                            <div class="form-group">
                                <label for="photo">
                                    <h6>Image URL</h6>
                                </label>
                                <input type="text" class="form-control" id="photo">
                            </div>
                            <br>
                            <div class="text-right">
                                <button type="submit" class="btn btn-primary btn-md" id="user-info-btn">
                                    Register Pet
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col"></div>
        </div>
        <div class="row">
            <div class="col"></div>
            <div class="col-12 col-md-10 col-lg-8">
                <div class="card mt-3 mb-3 d-none" id="survey">
                    <div class="card-header">
                        <h3>Compatibility Survey</h3>
                    </div>
                    <div class="card-text p-3">
                        <form role="form">
                            <div id="question-area">

                            </div>
                            <div class="text-right mt-4">
                                <button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#bestFriendModal" id="survey-btn">
                                    Find my Pet Pal
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col"></div>
        </div>
    </div>
    <div class="text-center mb-4">
        <button class="btn-primary find-button p-2 mt-2 d-none" data-toggle="modal" data-target="#bestFriendModal"><img src="/app/images/show-pet.gif" alt="Show Pet Pal" class="mini-pet">Show Pet Pal</button>
    </div>
    <div class="modal fade" id="bestFriendModal" tabindex="-1" role="dialog" aria-labelledby="bestFriendModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bestFriendModalLongTitle"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-center">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <a href="/">
                        <button type="button" class="btn btn-primary">Home</button>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>

    <!-- jQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- My Javascript -->
    <script>

        var user = {};
        var questions = [
            "My pet enjoys meeting new people.",
            "My pet enjoys exploring new areas.",
            "My pet enjoys physical interaction.",
            "My pet enjoys constant attention.",
            "My pet enjoys chasing things.",
            "My pet enjoys sleeping a lot.",
            "My pet enjoys climbing.",
            "My pet will eat anything given to them.",
            "My pet is always excited to see me.",
            "My pet dislikes water."
        ]

        function createQuestion(questionStr, questionNum, name) {
            $("#question-area").append(`
            <h5 class="question"><label for="question${questionNum}">${questionStr}</label></h5>
            <div class="btn-group btn-group-toggle" data-toggle="buttons" id="question1">
                <button class="btn btn-secondary p-0 pl-2 pr-2 d-none d-sm-block" disabled>Strongly Disagree</button>
                <label class="btn btn-secondary p-0 pl-2 pr-2 selection-button">
                    <input type="radio" name="question${questionNum}" value="1" autocomplete="off"> 1
                </label>
                <label class="btn btn-secondary p-0 pl-2 pr-2 selection-button">
                    <input type="radio" name="question${questionNum}" value="2" autocomplete="off"> 2
                </label>
                <label class="btn btn-secondary p-0 pl-2 pr-2 selection-button active">
                    <input type="radio" name="question${questionNum}" value="3" autocomplete="off" checked> 3
                </label>
                <label class="btn btn-secondary p-0 pl-2 pr-2 selection-button">
                    <input type="radio" name="question${questionNum}" value="4" autocomplete="off"> 4
                </label>
                <label class="btn btn-secondary p-0 pl-2 pr-2 selection-button">
                    <input type="radio" name="question${questionNum}" value="5" autocomplete="off"> 5
                </label>
                <button class="btn btn-secondary p-0 pl-2 pr-2 d-none d-sm-block" disabled>Strongly Agree</button>
            </div>
            <br>
        `)
        }


        //store user name and image url, then show the survey
        $(document).on("click", "#user-info-btn", function (event) {
            event.preventDefault();
            user = {};
            $("#user-info-messages").addClass("d-none");
            user.name = $("#name").val().trim();
            user.photo = $("#photo").val().trim();
            if (user.name && user.photo){ 
                $("#name").val("");
                $("#photo").val("");
                $("#user-info").addClass("d-none");
                $("#survey").removeClass("d-none");
                $("#survey-cat").attr("src", "/app/images/cat-survey.gif");
                questions.forEach(createQuestion);
            } else {
                $("#user-info-messages").removeClass("d-none");
                $("#user-info-messages").empty();
                if (!user.name)
                    $("#user-info-messages").append("<h3>Please input a name for your pet!</h3>");
                if (!user.photo)
                    $("#user-info-messages").append("<h3>Please input a url to an image of your pet!</h3>");
            }
        })

        // post user data on survey completion, receive back best match object to display in modal
        $(document).on("click", "#survey-btn", function (event) {
            event.preventDefault();
            $("#survey-cat").attr("src", "/app/images/cat-success.gif");
            $("#user-info").addClass("d-none");
            $("#survey").addClass("d-none");
            user.scores = [];
            for (var i = 0; i < questions.length; i++) {
                user.scores.push($(`input[type='radio'][name='question${i}']:checked`).val());
            }
            $.post("/api/friends/", user, function (response) {
                $(".modal-body").html(`<img src="${response.photo}" alt="${response.name}" class="modal-picture">`);
                $("#bestFriendModalLongTitle").html(`<span class="pet-name">${user.name}</span>'s new Pet Pal is <span class="pet-name">${response.name}</span>!`);
                $(".mini-pet").parent().removeClass("d-none");
            })
        })


    </script>
</body>

</html>